#!/usr/bin/env ruby
require 'json'

repo = 'laa-apply-for-legal-aid/laa-assure-hmrc-data-uat-ecr'

puts 'Identifying images to delete'
aws_access_key_id =  ENV["AWS_ACCESS_KEY_ID"]
puts "id length #{aws_access_key_id.length}"
aws_secret_access_key =  ENV["AWS_SECRET_ACCESS_KEY"]
puts "key length #{aws_secret_access_key.length}"
json_output = `AWS_ACCESS_KEY_ID=#{aws_access_key_id} AWS_SECRET_ACCESS_KEY=#{aws_secret_access_key} aws ecr describe-images --repository-name #{repo} --output json`
puts "output length #{json_output.length}"
puts "output value #{json_output[0,3]}"
images = JSON.parse(json_output)['imageDetails']
puts "ECR has #{images.count} images"
