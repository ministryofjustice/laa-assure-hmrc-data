# stub positive result for clamdscan command by default
#
RSpec.configure do |config|
  config.before do |example|
    unless example.metadata[:allow_clamav] == true
      stdout = "/some/file/path.csv: OK"
      stderr = ""
      status = instance_double(Process::Status, success?: true, exitstatus: 0)
      allow(Open3).to receive(:capture3).and_call_original
      allow(Open3)
        .to receive(:capture3)
        .with(/clamdscan/, any_args)
        .and_return([stdout, stderr, status])
    end
  end
end
